<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body class="bg-[#0E0E0F] lg:hidden block">
  <!-- Header -->
  <div class="flex justify-between items-center px-5 py-5">
    <div><a href="./index.html"><img src="./assets/img/left.png" alt=""></a></div>
    <div class="text-center">
      <h1 class="text-white text-2xl">Z.A.I.A</h1>
      <p class="text-sm text-[#777777]">Zero Artificial Intimacy Agent</p>
    </div>
    <div><a href="#"><img src="./assets/img/dot.png" class="2xl:w-[6px] 2xl:h-7 h-5 w-[4px]" alt=""></a></div>
  </div>
  <hr class="border-[1px] border-[#252323]">

  <!-- Chat Body -->
  <div id="chatBody" class="px-5 pt-5 space-y-6 overflow-y-auto pb-28"></div>

  <!-- Chat Input -->
  <div class="fixed bottom-0 left-0 right-0 bg-[#0E0E0E] pt-4 pb-6">
    <hr class="border-[1px] border-[#252323]">
    <div class="mt-4 px-6 flex items-center gap-4">
      <button><i class="fas fa-image text-[#777777]"></i></button>
      <div class="relative flex-1">
        <input
          id="userInput"
          type="text"
          placeholder="Start your chat.."
          class="w-full px-4 pr-20 py-2 rounded-full bg-[#161617] text-white placeholder-[#777777] focus:outline-none"
        />
      </div>
      <button><i class="fas fa-microphone text-[#777777]"></i></button>
      <button id="sendBtn" class="bg-[#5A44E9] w-10 h-10 flex items-center justify-center rounded-full">
        <i class="fas fa-paper-plane text-white"></i>
      </button>
    </div>
  </div>



  <script src="https://kit.fontawesome.com/a2ada4947c.js" crossorigin="anonymous"></script>
  <script>
  
    // --- Chatbot Logic ---
    const sendBtn = document.getElementById("sendBtn");
    const userInput = document.getElementById("userInput");
    const chatBody = document.getElementById("chatBody");

    const agentId = "1acefbf8-6b7c-4ef9-af9e-32dc00029a48";
    const userId = "802588d7-6079-404f-b8fd-444cc614ff73";

    sendBtn.addEventListener("click", () => sendPrompt(userInput.value));
    userInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendPrompt(userInput.value);
    });

    function generateUUID() {
      return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      );
    }

    function appendUserMessage(msg) {
      chatBody.innerHTML += `
        <div class="flex justify-end">
          <div class="bg-white text-black px-6 py-2 text-sm rounded-full max-w-xs">${msg}</div>
          <img src="./assets/img/zcomment.png" class="w-10 h-10 rounded-full ml-3" />
        </div>`;
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function appendAgentMessage(msg) {
      chatBody.innerHTML += `
        <div class="flex gap-3 py-5">
          <img src="./assets/img/zaia.png" class="w-10 h-10 rounded-full ml-3" />
          <div class="bg-[#1E1E1E] text-[#777777] text-sm px-6 py-2 rounded-full max-w-xs">${msg}</div>
        </div>`;
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function addTyping() {
      chatBody.innerHTML += `
        <div id="agentTyping" class="flex gap-3 animate-pulse">
          <img src="./assets/img/zaia.png" class="w-10 h-10 rounded-full ml-3" />
          <div class="bg-[#1E1E1E] text-[#777777] text-sm px-6 py-2 rounded-full max-w-xs">Thinking...</div>
        </div>`;
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function removeTyping() {
      document.getElementById("agentTyping")?.remove();
    }

    async function sendPrompt(prompt) {
      const cleaned = prompt.trim();
      if (!cleaned) return;
      appendUserMessage(cleaned);
      userInput.value = "";
      addTyping();

      const sessionId = generateUUID();
      try {
        const res = await fetch("https://agent-kinkybunny.aag.systems/api/interact", {
          method: "POST",
          headers: {
            accept: "application/json",
            "x-api-key": "61597eab559ac4fb3b71242b7f88fe8c",
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            agentId,
            userId,
            sessionId,
            prompt: cleaned,
          }),
        });

        const data = await res.json();
        removeTyping();

        if (!data || !data.response) {
          appendAgentMessage("‚ö†Ô∏è No response from ZAIA. Try again.");
          return;
        }

        if (typeof data.response === "string") {
          appendAgentMessage(data.response);
        } else {
          appendAgentMessage("‚ö†Ô∏è Unexpected response format.");
        }
      } catch (err) {
        removeTyping();
        appendAgentMessage("Oops, something went wrong üò¨");
        console.error("‚ùå Error:", err);
      }
    }
  </script>
</body>

</html>